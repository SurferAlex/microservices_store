name: CI Pipeline

# ÐšÐ¾Ð³Ð´Ð° Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ workflow
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

# Ð—Ð°Ð´Ð°Ñ‡Ð¸ (jobs)
jobs:
  # Ð—Ð°Ð´Ð°Ñ‡Ð°: Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð´Ð°
  check:
    name: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð´Ð°
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð´Ð°
        uses: actions/checkout@v4
      
      - name: ðŸ”§ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.25'
      
      - name: ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ auth_service
        working-directory: ./auth_service
        run: |
          echo "ðŸ“ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð° auth_service..."
          if [ "$(gofmt -s -l . | wc -l)" -gt 0 ]; then
            echo "âŒ ÐšÐ¾Ð´ Ð½Ðµ Ð¾Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½! Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: gofmt -s -w ."
            gofmt -s -d .
            exit 1
          fi
          echo "âœ… Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾!"
      
      - name: ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ profile_service
        working-directory: ./profile_service
        run: |
          echo "ðŸ“ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð° profile_service..."
          if [ "$(gofmt -s -l . | wc -l)" -gt 0 ]; then
            echo "âŒ ÐšÐ¾Ð´ Ð½Ðµ Ð¾Ñ‚Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½! Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: gofmt -s -w ."
            gofmt -s -d .
            exit 1
          fi
          echo "âœ… Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾!"
      
      - name: ðŸ” Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· auth_service
        working-directory: ./auth_service
        run: |
          echo "ðŸ”Ž Ð—Ð°Ð¿ÑƒÑÐºÐ°ÑŽ go vet Ð´Ð»Ñ auth_service..."
          go vet ./...
          echo "âœ… Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½!"
      
      - name: ðŸ” Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· profile_service
        working-directory: ./profile_service
        run: |
          echo "ðŸ”Ž Ð—Ð°Ð¿ÑƒÑÐºÐ°ÑŽ go vet Ð´Ð»Ñ profile_service..."
          go vet ./...
          echo "âœ… Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½!"
      
      - name: ðŸ“¦ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ auth_service
        working-directory: ./auth_service
        run: |
          echo "ðŸ“‹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ go.mod Ð¸ go.sum Ð´Ð»Ñ auth_service..."
          go mod tidy
          if [ -n "$(git status --porcelain)" ]; then
            echo "âŒ go.mod Ð¸Ð»Ð¸ go.sum Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ! Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: go mod tidy"
            git status
            exit 1
          fi
          echo "âœ… Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹!"
      
      - name: ðŸ“¦ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ profile_service
        working-directory: ./profile_service
        run: |
          echo "ðŸ“‹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ go.mod Ð¸ go.sum Ð´Ð»Ñ profile_service..."
          go mod tidy
          if [ -n "$(git status --porcelain)" ]; then
            echo "âŒ go.mod Ð¸Ð»Ð¸ go.sum Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ! Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: go mod tidy"
            git status
            exit 1
          fi
          echo "âœ… Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹!"
      
      - name: ðŸ“¦ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸ auth_service
        working-directory: ./auth_service
        run: |
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ auth_service..."
          go mod download
          go build ./cmd/main.go
          echo "âœ… auth_service ÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
      
      - name: ðŸ“¦ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸ profile_service
        working-directory: ./profile_service
        run: |
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ profile_service..."
          go mod download
          go build ./cmd/main.go
          echo "âœ… profile_service ÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
      
      - name: âœ… Ð’ÑÐµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹
        run: |
          echo "ðŸŽ‰ Ð’ÑÐµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð° Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
      
      - name: ðŸ“Š Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Summary
        if: success()
        run: |
          echo "## âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð´Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸:" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð° (gofmt)" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· (go vet)" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ (go mod tidy)" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð²" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹:**" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… auth_service" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… profile_service" >> $GITHUB_STEP_SUMMARY

  # Ð—Ð°Ð´Ð°Ñ‡Ð°: ÑÐ±Ð¾Ñ€ÐºÐ° Docker Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²
  build:
    name: Ð¡Ð±Ð¾Ñ€ÐºÐ° Docker Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²
    runs-on: ubuntu-latest
    needs: check
    permissions:
      contents: read
      packages: write
    
    steps:
      - name: ðŸ“¥ ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð´Ð°
        uses: actions/checkout@v4
      
      - name: ðŸ” ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð² GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ðŸ³ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: ðŸ·ï¸ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ñ‚ÐµÐ³Ð¾Ð² Ð´Ð»Ñ auth_service
        id: meta-auth
        run: |
          OWNER=$(echo "${{ github.repository_owner }}" | tr '[:upper:]' '[:lower:]')
          IMAGE_NAME="ghcr.io/${OWNER}/auth_service"
          VERSION="${GITHUB_REF#refs/heads/}"
          VERSION="${VERSION#refs/tags/}"
          VERSION="${VERSION:-latest}"
          VERSION=$(echo "$VERSION" | tr '[:upper:]' '[:lower:]')
          echo "tags=$IMAGE_NAME:$VERSION,$IMAGE_NAME:latest" >> $GITHUB_OUTPUT
          echo "ðŸ“¦ Ð¢ÐµÐ³Ð¸ Ð´Ð»Ñ auth_service: $IMAGE_NAME:$VERSION, $IMAGE_NAME:latest"
      
      - name: ðŸ·ï¸ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ñ‚ÐµÐ³Ð¾Ð² Ð´Ð»Ñ profile_service
        id: meta-profile
        run: |
          OWNER=$(echo "${{ github.repository_owner }}" | tr '[:upper:]' '[:lower:]')
          IMAGE_NAME="ghcr.io/${OWNER}/profile_service"
          VERSION="${GITHUB_REF#refs/heads/}"
          VERSION="${VERSION#refs/tags/}"
          VERSION="${VERSION:-latest}"
          VERSION=$(echo "$VERSION" | tr '[:upper:]' '[:lower:]')
          echo "tags=$IMAGE_NAME:$VERSION,$IMAGE_NAME:latest" >> $GITHUB_OUTPUT
          echo "ðŸ“¦ Ð¢ÐµÐ³Ð¸ Ð´Ð»Ñ profile_service: $IMAGE_NAME:$VERSION, $IMAGE_NAME:latest"
      
      - name: ðŸ—ï¸ Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¸ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð·Ð° auth_service
        uses: docker/build-push-action@v5
        with:
          context: ./auth_service
          file: ./auth_service/Dockerfile
          push: ${{ github.ref == 'refs/heads/main' }}
          tags: ${{ steps.meta-auth.outputs.tags }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
      
      - name: ðŸ—ï¸ Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¸ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð·Ð° profile_service
        uses: docker/build-push-action@v5
        with:
          context: ./profile_service
          file: ./profile_service/Dockerfile
          push: ${{ github.ref == 'refs/heads/main' }}
          tags: ${{ steps.meta-profile.outputs.tags }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
      
      - name: âœ… ÐžÐ±Ñ€Ð°Ð·Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð±Ñ€Ð°Ð½Ñ‹
        run: |
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            OWNER=$(echo "${{ github.repository_owner }}" | tr '[:upper:]' '[:lower:]')
            echo "ðŸŽ‰ Docker Ð¾Ð±Ñ€Ð°Ð·Ñ‹ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ñ‹ Ð² GitHub Container Registry!"
            echo "ðŸ“¦ auth_service: ghcr.io/${OWNER}/auth_service:latest"
            echo "ðŸ“¦ profile_service: ghcr.io/${OWNER}/profile_service:latest"
          else
            echo "âœ… Docker Ð¾Ð±Ñ€Ð°Ð·Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð±Ñ€Ð°Ð½Ñ‹ (Ð½Ðµ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ñ‹, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð½Ðµ main Ð²ÐµÑ‚ÐºÐ°)"
          fi
      
      - name: ðŸ“Š Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Summary
        if: success()
        run: |
          OWNER=$(echo "${{ github.repository_owner }}" | tr '[:upper:]' '[:lower:]')
          echo "## ðŸ³ Docker Ð¾Ð±Ñ€Ð°Ð·Ñ‹ ÑÐ¾Ð±Ñ€Ð°Ð½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            echo "### ðŸ“¦ ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð·Ñ‹:" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… \`ghcr.io/${OWNER}/auth_service:latest\`" >> $GITHUB_STEP_SUMMARY
            echo "- âœ… \`ghcr.io/${OWNER}/profile_service:latest\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "ÐžÐ±Ñ€Ð°Ð·Ñ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² [GitHub Packages](https://github.com/${{ github.repository }}/pkgs)" >> $GITHUB_STEP_SUMMARY
          else
            echo "### â„¹ï¸ ÐžÐ±Ñ€Ð°Ð·Ñ‹ ÑÐ¾Ð±Ñ€Ð°Ð½Ñ‹, Ð½Ð¾ Ð½Ðµ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ñ‹" >> $GITHUB_STEP_SUMMARY
            echo "ÐŸÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ push Ð² Ð²ÐµÑ‚ÐºÑƒ \`main\`" >> $GITHUB_STEP_SUMMARY
          fi

  # Ð—Ð°Ð´Ð°Ñ‡Ð°: Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Ð‘Ð”
  migrations:
    name: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Ð‘Ð”
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð´Ð°
        uses: actions/checkout@v4
      
      - name: ðŸ”§ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° golang-migrate
        run: |
          echo "ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽ golang-migrate..."
          curl -L https://github.com/golang-migrate/migrate/releases/download/v4.17.0/migrate.linux-amd64.tar.gz | tar xvz
          sudo mv migrate /usr/local/bin/migrate
          migrate -version
          echo "âœ… golang-migrate ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½!"
      
      - name: ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ auth_service
        run: |
          echo "ðŸ“‹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ auth_service..."
          cd auth_service/migrations
          for file in *.up.sql; do
            base="${file%.up.sql}"
            if [ ! -f "${base}.down.sql" ]; then
              echo "âŒ ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° down-Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ: $file"
              exit 1
            fi
            echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½Ð° Ð¿Ð°Ñ€Ð°: ${base}.up.sql Ð¸ ${base}.down.sql"
          done
          for file in *.down.sql; do
            base="${file%.down.sql}"
            if [ ! -f "${base}.up.sql" ]; then
              echo "âŒ ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° up-Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ: $file"
              exit 1
            fi
          done
          echo "âœ… Ð’ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ auth_service Ð¸Ð¼ÐµÑŽÑ‚ Ð¿Ð°Ñ€Ñ‹ up/down"
      
      - name: ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ profile_service
        run: |
          echo "ðŸ“‹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ profile_service..."
          cd profile_service/migrations
          for file in *.up.sql; do
            base="${file%.up.sql}"
            if [ ! -f "${base}.down.sql" ]; then
              echo "âŒ ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° down-Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ: $file"
              exit 1
            fi
            echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½Ð° Ð¿Ð°Ñ€Ð°: ${base}.up.sql Ð¸ ${base}.down.sql"
          done
          for file in *.down.sql; do
            base="${file%.down.sql}"
            if [ ! -f "${base}.up.sql" ]; then
              echo "âŒ ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° up-Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ: $file"
              exit 1
            fi
          done
          echo "âœ… Ð’ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ profile_service Ð¸Ð¼ÐµÑŽÑ‚ Ð¿Ð°Ñ€Ñ‹ up/down"
      
      - name: ðŸ” Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ° SQL Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹
        run: |
          echo "ðŸ”Ž ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ SQL Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
          find auth_service/migrations profile_service/migrations -name "*.sql" -type f | while read file; do
            if [ ! -s "$file" ]; then
              echo "âŒ ÐŸÑƒÑÑ‚Ð¾Ð¹ Ñ„Ð°Ð¹Ð» Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸: $file"
              exit 1
            fi
            echo "âœ… Ð¤Ð°Ð¹Ð» Ð½Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð¹: $file"
          done
          echo "âœ… Ð’ÑÐµ SQL Ñ„Ð°Ð¹Ð»Ñ‹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Ð²Ð°Ð»Ð¸Ð´Ð½Ñ‹!"
      
      - name: âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°
        run: |
          echo "ðŸŽ‰ Ð’ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð‘Ð” Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
      
      - name: ðŸ“Š Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Summary
        if: success()
        run: |
          echo "## âœ… ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð‘Ð” Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½Ñ‹Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸:" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… auth_service: ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¸ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… profile_service: ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¸ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Ð’ÑÐµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¸Ð¼ÐµÑŽÑ‚ Ð¿Ð°Ñ€Ñ‹ \`.up.sql\` Ð¸ \`.down.sql\`" >> $GITHUB_STEP_SUMMARY